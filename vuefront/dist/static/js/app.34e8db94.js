(function(t){function e(e){for(var n,r,i=e[0],l=e[1],u=e[2],f=0,p=[];f<i.length;f++)r=i[f],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&p.push(o[r][0]),o[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);c&&c(e);while(p.length)p.shift()();return a.push.apply(a,u||[]),s()}function s(){for(var t,e=0;e<a.length;e++){for(var s=a[e],n=!0,i=1;i<s.length;i++){var l=s[i];0!==o[l]&&(n=!1)}n&&(a.splice(e--,1),t=r(r.s=s[0]))}return t}var n={},o={app:0},a=[];function r(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=n,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(s,n,function(e){return t[e]}.bind(null,n));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var u=0;u<i.length;u++)e(i[u]);var c=l;a.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";var n=s("64a9"),o=s.n(n);o.a},2297:function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);s("cadf"),s("551c"),s("f751"),s("097d");var n=s("2b0e"),o=s("5c96"),a=s.n(o),r=(s("0fae"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("HelloMessage"),s("el-footer",[s("small",[s("br"),t._v("\n    \n    Inspired from "),s("el-link",{attrs:{underline:!1,type:"primary",target:"_blank",href:"https://mxh-mini-apps.github.io/mxh-cp-stories/"}},[t._v("https://mxh-mini-apps.github.io/mxh-cp-stories/.")]),s("br")],1)])],1)}),i=[],l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("h1",[t._v("CP短打生成器 V2")]),s("br"),s("br"),s("el-row",{attrs:{gutter:18}},[s("el-col",{staticStyle:{"margin-top":"15px"},attrs:{xs:24,sm:12,md:12,lg:12}},[s("el-input",{attrs:{placeholder:"攻め"},model:{value:t.gong,callback:function(e){t.gong=e},expression:"gong"}},[s("template",{slot:"prepend"},[t._v("攻")])],2)],1),s("el-col",{staticStyle:{"margin-top":"15px"},attrs:{xs:24,sm:12,md:12,lg:12}},[s("el-input",{attrs:{placeholder:"受け"},model:{value:t.shou,callback:function(e){t.shou=e},expression:"shou"}},[s("template",{slot:"prepend"},[t._v("受")])],2)],1)],1),s("br"),s("br"),s("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"center"}},[s("el-button",{attrs:{type:"success",disabled:""===t.gong||""===t.shou},on:{click:t.writeStory}},[t._v(t._s(t.btnText))]),s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.dialogAdd=!0}}},[t._v("投稿")])],1),s("el-divider"),s("el-main",[s("p",{attrs:{id:"story"},domProps:{innerHTML:t._s(t.story)}},[t._v(t._s(t.story))])]),s("el-dialog",{attrs:{title:"投稿(需审核)",visible:t.dialogAdd,width:t.dialogWidth},on:{"update:visible":function(e){t.dialogAdd=e}}},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"作者*"}},[s("el-input",{model:{value:t.form.author,callback:function(e){t.$set(t.form,"author",e)},expression:"form.author"}})],1),s("el-form-item",{attrs:{label:"创意*"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:5},placeholder:"投稿格式 e.g. 都说<攻>的眼里藏了长驻的冰雪。<受>阖眸前迷迷糊糊地笑——你看，这不是化了吗？"},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),s("el-form-item",{attrs:{label:"标签"}},[t._l(t.form.tags,(function(e){return s("el-tag",{key:e,attrs:{effect:"dark",closable:"","disable-transitions":!1,type:"success"},on:{close:function(s){return t.handleClose(e)}}},[t._v(t._s(e))])})),t.form.inputVisible?s("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(e)}},model:{value:t.form.inputValue,callback:function(e){t.$set(t.form,"inputValue",e)},expression:"form.inputValue"}}):s("el-button",{staticClass:"button-new-tag",attrs:{size:"small",icon:"el-icon-plus",circle:""},on:{click:t.showInput}})],2)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",disabled:!t.form.content||!t.form.author},on:{click:function(e){return t.addMessage({author:t.form.author,content:t.form.content,is_public:t.form.is_public,tags:t.form.tags})}}},[t._v("Submit")])],1)],1),s("el-dialog",{attrs:{title:"编辑",visible:t.dialogEdit,width:"50%"},on:{"update:visible":function(e){t.dialogEdit=e}}},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"作者"}},[s("el-input",{model:{value:t.form.author,callback:function(e){t.$set(t.form,"author",e)},expression:"form.author"}})],1),s("el-form-item",{attrs:{label:"Content"}},[s("el-input",{attrs:{type:"textarea",autosize:""},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),s("el-form-item",{attrs:{label:"Tags"}},[t._l(t.form.tags,(function(e){return s("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1},on:{close:function(s){return t.handleClose(e)}}},[t._v(t._s(e))])})),t.form.inputVisible?s("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(e)}},model:{value:t.form.inputValue,callback:function(e){t.$set(t.form,"inputValue",e)},expression:"form.inputValue"}}):s("el-button",{staticClass:"button-new-tag",attrs:{size:"small",icon:"el-icon-plus",circle:""},on:{click:t.showInput}})],2)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",disabled:!t.form.content},on:{click:function(e){return t.putMessage({id:t.form.id,author:t.form.author,content:t.form.content,tags:t.form.tags})}}},[t._v("Submit")])],1)],1)],1)},u=[],c=(s("3b2b"),s("a481"),s("2f62")),f={name:"Messages",data:function(){return{gong:"",shou:"",story:"",btnText:"生成故事",dialogAdd:!1,dialogEdit:!1,dialogWidth:0}},computed:Object(c["b"])({messages:function(t){return t.messages},form:function(t){return t.form}}),methods:{writeStory:function(){var t;t=""===this.story?0:Math.floor(Math.random()*this.messages.length),this.shuffle(this.messages),this.$nextTick((function(){""!==this.gong&&""!==this.shou?this.btnText="生成新故事":this.btnText="生成故事"})),this.messages[0]?(this.story=this.messages[t].content.replace(/\r?\n/g,"<br/><br/>").replace(new RegExp("<攻>","g"),'<span class="e-brown">'+this.gong+"</span>").replace(new RegExp("<受>","g"),'<span class="e-pink">'+this.shou+"</span>"),this.story=this.story+"<br><br><span> By "+this.messages[t].author+"</span>"):this.openVn("请求过多，请稍后重试")},shuffle:function(t){for(var e=t.length-1;e>0;e--){var s=Math.floor(Math.random()*(e+1)),n=[t[s],t[e]];t[e]=n[0],t[s]=n[1]}},openVn:function(t){var e=this.$createElement;this.$message({message:e("p",null,[e("span",null,t),e("strong",{style:"color: #FFBF00"},"!!!")])})},addMessage:function(t){this.$store.dispatch("addMessage",t),this.openVn("提交成功")},getMessage:function(t){this.$store.dispatch("getMessage",t),this.dialogEdit=!0},patchMessage:function(t){this.$store.dispatch("patchMessage",t)},putMessage:function(t){this.$store.dispatch("putMessage",t)},deleteMessage:function(t){this.$store.dispatch("deleteMessage",t)},handleClose:function(t){this.form.tags.splice(this.form.tags.indexOf(t),1)},showInput:function(){var t=this;this.form.inputVisible=!0,this.$nextTick((function(e){t.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){var t=this.form.inputValue;t&&this.form.tags.push(t),this.form.inputVisible=!1,this.form.inputValue=""},setDialogWidth:function(){var t=document.body.clientWidth,e=640;this.dialogWidth=t<e?"90%":e+"px"}},created:function(){this.$store.dispatch("getMessages"),this.setDialogWidth()}},p=f,m=(s("b1d4"),s("2877")),d=Object(m["a"])(p,l,u,!1,null,null,null),g=d.exports,h={name:"app",components:{HelloMessage:g}},b=h,v=(s("034f"),Object(m["a"])(b,r,i,!1,null,null,null)),y=v.exports,M=s("bc3a"),x=s.n(M),k=s("a78e"),_=s.n(k),w=x.a.create({baseURL:"/api",timeout:5e3,headers:{"Content-Type":"application/json","X-CSRFToken":_.a.get("csrftoken")}}),C={fetchMessages:function(){return w.get("messages/").then((function(t){return t.data}))},postMessage:function(t){return w.post("messages/",t).then((function(t){return t.data}))},deleteMessage:function(t){return w.delete("messages/".concat(t)).then((function(t){return t.data}))},getMessage:function(t){return w.get("messages/".concat(t,"/")).then((function(t){return t.data})).catch((function(t){console.log(t)}))},patchMessage:function(t,e){return w.patch("messages/".concat(t,"/"),e).then((function(t){return t.data})).catch((function(t){console.log(t)}))},putMessage:function(t,e){return w.put("messages/".concat(t,"/"),e).then((function(t){return t.data})).catch((function(t){console.log(t)}))}};n["default"].use(c["a"]);var $=new c["a"].Store({namespaced:!0,state:{messages:[],form:{id:0,author:"mxh-cp-stories",content:"",tags:[],inputVisible:!1,inputValue:"",is_public:!1}},getters:{messages:function(t){return t.messages},form:function(t){return t.form}},mutations:{setMessages:function(t,e){t.messages=e},addMessage:function(t,e){t.messages.push(e)},getMessage:function(t,e){t.form.id=e.id,t.form.content=e.content,t.form.author=e.author,t.form.tags=e.tags},putMessage:function(t,e,s){var n=t.messages.splice(e,1,s);t.messages=n},patchMessage:function(t,e,s){var n=t.messages.splice(e,1,s);t.messages=n},deleteMessage:function(t,e){t.messages=t.messages.filter((function(t){return t.id!==e}))}},actions:{getMessages:function(t){var e=t.commit;C.fetchMessages().then((function(t){e("setMessages",t)}))},getMessage:function(t,e){var s=t.commit;C.getMessage(e).then((function(t){s("getMessage",t)}))},addMessage:function(t,e){var s=t.commit;C.postMessage(e).then((function(){s("addMessage",e)}))},putMessage:function(t,e){var s=t.commit;C.putMessage(e.id,e),s("putMessage",e.id,e)},patchMessage:function(t,e){var s=t.commit;C.patchMessage(e.id,e),s("patchMessage",e.id,e)},deleteMessage:function(t,e){var s=t.commit;C.deleteMessage(e),s("deleteMessage",e)}}});n["default"].use(a.a),n["default"].config.productionTip=!1,new n["default"]({store:$,render:function(t){return t(y)}}).$mount("#app")},"64a9":function(t,e,s){},b1d4:function(t,e,s){"use strict";var n=s("2297"),o=s.n(n);o.a}});
//# sourceMappingURL=app.34e8db94.js.map